module path where

def ¬¨ (A : V) := A ‚Üí ùüé

def id (A : U) : U := A
def idfun (A : U) (a : A) : A := a

def ‚àò (A B C : U) (f : B ‚Üí C) (g : A ‚Üí B) : A ‚Üí C := Œª (x : A), f (g x)

def Path‚Ä≤ (A : U) (a b : A) := Path A a b

def contr (A : U) (x : A) := Œ† (y : A), Path A x y
def is-contr (A : U) : U := Œ£ (x : A), contr A x
def is-prop (A : U) : U := Œ† (a b : A), Path A a b
def is-set (A : U) : U := Œ† (a b : A), is-prop (Path A a b)
def is-groupoid (A : U) : U := Œ† (a b : A), is-set (Path A a b)
def is-2-groupoid (A : U) : U := Œ† (a b : A), is-groupoid (Path A a b)

def contr-impl-prop (A : U) (z : is-contr A) : is-prop A :=
Œª (a b : A), (z.2 a)‚Åª¬π ‚¨ù z.2 b

def subst (A : U) (P : A ‚Üí U) (a b : A) (p : Path A a b) (x : P a) : P b :=
coe (apd P p) x

def ap (A B : U) (f : A ‚Üí B) (a b : A) (p : Path A a b) : Path B (f a) (f b) :=
apd f p

def meet (A : U) (a b : A) (p : Path A a b) :
  Path (Œ£ (x : A), Path A a x) (Œ£-mk (Path‚Ä≤ A a) a (idp a)) (Œ£-mk (Path‚Ä≤ A a) b p) :=
Œ£‚Åº p (Œª (x : A), Path A a x) (idp a) p (idp p)

def J (A : U) (P : Œ† (a b : A), Path A a b ‚Üí U)
  (a : A) (d : P a a (idp a)) (b : A) (p : Path A a b) : P a b p :=
coe (apd (Œª (w : Œ£ (x : A), Path A a x), P a w.1 w.2) (meet A a b p)) d

def ap‚Ä≤ (A B : U) (f : A ‚Üí B) (a b : A) (p : Path A a b) : Path B (f a) (f b) :=
J A (Œª (a b : A) (p : Path A a b), Path B (f a) (f b)) a (idp (f a)) b p

def bimap (A B C : U) (a b : A) (a‚Ä≤ b‚Ä≤ : B) (f : A ‚Üí B ‚Üí C)
  (p : Path A a b) (q : Path B a‚Ä≤ b‚Ä≤) : Path C (f a a‚Ä≤) (f b b‚Ä≤) :=
J A (Œª (a b : A) (p : Path A a b), Path C (f a a‚Ä≤) (f b b‚Ä≤))
  a (ap B C (f a) a‚Ä≤ b‚Ä≤ q) b p

def bimap‚Ä≤ (A B C : U) (a b : A) (a‚Ä≤ b‚Ä≤ : B) (f : A ‚Üí B ‚Üí C)
  (p : Path A a b) (q : Path B a‚Ä≤ b‚Ä≤) : Path C (f a a‚Ä≤) (f b b‚Ä≤) :=
J B (Œª (a‚Ä≤ b‚Ä≤ : B) (p : Path B a‚Ä≤ b‚Ä≤), Path C (f a a‚Ä≤) (f b b‚Ä≤))
  a‚Ä≤ (ap A C (Œª (x : A), f x a‚Ä≤) a b p) b‚Ä≤ q

def bimap-eq-bimap‚Ä≤ (A B C : U) (a b : A) (a‚Ä≤ b‚Ä≤ : B) (f : A ‚Üí B ‚Üí C) (p : Path A a b) (q : Path B a‚Ä≤ b‚Ä≤) :
  Path (Path C (f a a‚Ä≤) (f b b‚Ä≤)) (bimap A B C a b a‚Ä≤ b‚Ä≤ f p q) (bimap‚Ä≤ A B C a b a‚Ä≤ b‚Ä≤ f p q) :=
J A (Œª (a b : A) (p : Path A a b),
  Path (Path C (f a a‚Ä≤) (f b b‚Ä≤)) (bimap A B C a b a‚Ä≤ b‚Ä≤ f p q)
                                  (bimap‚Ä≤ A B C a b a‚Ä≤ b‚Ä≤ f p q))
  a (idp (ap B C (f a) a‚Ä≤ b‚Ä≤ q)) b p

def diagonal-bimap (A B : U) (f : A ‚Üí A ‚Üí B) (a b : A) (p : Path A a b) :
  Path (Path B (f a a) (f b b)) (bimap A A B a b a b f p p) (ap A B (Œª (x : A), f x x) a b p) :=
J A (Œª (a b : A) (p : Path A a b), Path (Path B (f a a) (f b b)) (bimap A A B a b a b f p p) (ap A B (Œª (x : A), f x x) a b p))
  a (idp (idp (f a a))) b p

def J‚Ä≤ (A : U) (a : A) (P : Œ† (b : A), Path A a b ‚Üí U)
  (d : P a (idp a)) (b : A) (p : Path A a b) : P b p :=
coe (apd (Œª (w : Œ£ (x : A), Path A a x), P w.1 w.2) (meet A a b p)) d

def singl (A : U) (a : A) := Œ£ (b : A), Path A a b
def contr-singl (A : U) (a : A) : is-contr (singl A a) :=
Œ£-mk (contr (singl A a)) (Œ£-mk (Path‚Ä≤ A a) a (idp a))
  (Œª (w : Œ£ (x : A), Path A a x), meet A a w.1 w.2)

def PathP (A : U) (B : A ‚Üí U) (a b : A) (p : Path A a b) (u : B a) (v : B b) :=
Path (B b) (subst A B a b p u) v

def Œ£-eq (A : U) (B : A ‚Üí U) (a b : A) (p : Path A a b) (u : B a) (v : B b)
  (q : PathP A B a b p u v) : Path (Œ£ (x : A), B x) (Œ£-mk B a u) (Œ£-mk B b v) :=
J A (Œª (a b : A) (p : Path A a b), Œ† (u : B a) (v : B b)
  (q : PathP A B a b p u v), Path (Œ£ (x : A), B x) (Œ£-mk B a u) (Œ£-mk B b v)) a
  (Œª (u v : B a) (q : Path (B a) u v), apd (Œª (x : B a), Œ£-mk B a x) q)
  b p u v q
